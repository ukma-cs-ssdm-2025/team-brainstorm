### US-001 — Онлайн каталог
- **Статус:** Частково виконано
- **Що є:**
  - Перегляд списку книг: `GET /books` у `src/api/routes/books.py` (функція `list_books`) з фільтром `available_only`.
- **Чого не вистачає:**
  - Сортування в алфавітному порядку (не підтримується параметр сортування, явного сортування немає).

### US-002 — Видача онлайн книг
- **Статус:** Не виконано
- **Що є:**
  - В каталозі є книги й резервації, але відсутні ендпоінти/логіка видачі електронних копій.
- **Чого не вистачає:**
  - API для отримання електронної книги (посилання/файл/стрімінг), перевірка доступності e-book.

### US-003 — Список бажань
- **Статус:** Виконано
- **Що є:**
  - Список бажань реалізовано в `src/api/routes/favorites.py`:
    - `GET /favorites/me` (з `expand` для розгорнутих даних),
    - `POST /favorites/me` (додавання),
    - `DELETE /favorites/me/{book_id}` (видалення),
    - `DELETE /favorites/me` (очистка),
    - `GET /favorites/me/count` (кількість).
  - Ідентифікація користувача через заголовок `X-User-Email`.

### US-004 — Нагадування про повернення книг
- **Статус:** Частково виконано
- **Що є:**
  - `GET /reminders` у `src/api/routes/reminders.py` формує нагадування, якщо до дати `until` залишилось ≤ 2 дні.
  - У `src/services/reminder_service.py` є `get_due_soon_reservations` і `send_reminders` (імітація відправки, через консольний вивід).
- **Чого не вистачає:**
  - Реальна інтеграція з email/пуш-сервісом, планування (scheduler/cron), конфігурація каналів доставки.

### US-005 — Розширений пошук за жанрами
- **Статус:** Не виконано
- **Що є:**
  - У моделях книг є `genres` (див. `BookOut` у `books.py`).
- **Чого не вистачає:**
  - Параметри фільтрації за одним/декількома жанрами в ендпоінтах каталогу, відповідна логіка відбору.

### US-006 — Відгуки та рейтинги книг
- **Статус:** Не виконано
- **Що є:**
  - Відсутні моделі/схеми/ендпоінти для відгуків та рейтингів.
- **Чого не вистачає:**
  - CRUD для відгуків, модель рейтингу (1–5), агрегації/середні оцінки, прив’язка до користувача/книги.

### US-007 — Редагування інформації про книги
- **Статус:** Виконано
- **Що є:**
  - `PATCH /books/{book_id}` у `src/api/routes/books.py` (функція `update_book`) з перевіркою ролі через заголовок `X-Role` (має бути `librarian`).
  - Підтримується оновлення полів (назва, автор, опис, рік видання, кількість примірників, жанри тощо) з інваріантами для `reserved_count`.

### US-008 — Резервування книг
- **Статус:** Частково виконано
- **Що є:**
  - Створення бронювання: `POST /reservations` у `src/api/routes/reservations.py` делегує в `src/services/reservations_service.py` (`create_reservation_for_user`), перевіряє доступні копії, інкрементує `reserved_count`.
  - Скасування бронювання: `DELETE /reservations/{reservation_id}` з декрементом `reserved_count`.
- **Чого не вистачає:**
  - Черга очікування, якщо книга недоступна (зараз повертається `409 Conflict` без постановки в чергу та без сповіщення).

---

## Підсумок
- Виконано: US-003, US-007
- Частково виконано: US-001, US-004, US-008
- Не виконано: US-002, US-005, US-006

## Тестове покриття

На основі аналізу `tests/test_reservations.py`:

### ✅ Протестовані функції:
- **Health check**: `test_health()` - перевірка доступності API
- **Каталог книг**: 
  - `test_list_books()` - отримання списку книг
  - `test_list_books_available_only()` - фільтрація доступних книг
- **Резервування**:
  - `test_create_and_cancel_reservation()` - створення та скасування резервації
  - `test_cancel_nonexistent_reservation()` - обробка неіснуючих резервацій
  - `test_create_reservation_with_invalid_book()` - валідація неіснуючих книг
  - `test_create_reservation_missing_fields()` - валідація відсутніх полів
- **Редагування книг**:
  - `test_update_book_forbidden_for_non_librarian()` - перевірка прав доступу
  - `test_update_book_not_found()` - обробка неіснуючих книг
- **Користувачі та ролі**: `test_user_registration_and_roles()` - реєстрація та ролі
- **Нагадування**: `test_send_reminder_for_due_books()` - відправка нагадувань


### ❌ Не протестовані функції:
- Список бажань (`/favorites/*`)
- Видача електронних книг
- Фільтрація за жанрами
- Відгуки та рейтинги
